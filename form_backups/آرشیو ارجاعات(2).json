{"name":"آرشیو ارجاعات","description":"","items":[{"type":"form","variable":"","var_uid":"","dataType":"","id":"25220647868049c46c40a17053700449","name":"آرشیو ارجاعات","description":"","mode":"edit","script":{"type":"js","code":"// Global variables (assuming these are needed elsewhere)\nvar dyn_uid1 = document.forms[0].id;\nvar step_mode1 = getFormById(dyn_uid1).model.attributes.mode;\nvar host = PMDynaform.getHostName();\n\n// Function to hide specific columns\nfunction hideSpecificColumns() {\n    const selectors = [\n        \"th:nth-child(2), td:nth-child(2)\", // نوع نامه (Letter Type)\n        \"th:nth-child(3), td:nth-child(3)\", // دبیرخانه (Dabirkhaneh)\n        \"th:nth-child(10), td:nth-child(10)\", // سازمان (Organization)\n        \"th:nth-child(11), td:nth-child(11)\", // شماره نامه ورودی (Input Letter Number)\n        \"th:nth-child(12), td:nth-child(12)\" // تاریخ نامه ورودی (Input Letter Date)\n    ];\n    $(\"#panel_grid .panel-body table\").find(selectors.join(\", \")).css(\"display\", \"none\");\n}\n\n// Function to hide rows with \"نامه خروجی\" or \"نامه ورودی\"\nfunction hideNonInternalLetters() {\n    $(\"#panel_grid .panel-body table tr.xcrud-row\").each(function() {\n        const letterType = $(this).children(\"td:nth-child(2)\").text().trim();\n        $(this).toggle(!(letterType === \"نامه خروجی\" || letterType === \"نامه ورودی\"));\n    });\n}\n\n// Function to rename column titles\nfunction renameColumnTitles() {\n    $(\"#panel_grid .panel-body table th[data-orderby='auto_letter.j_letter_date']\").text(\"تاریخ\");     // تاریخ نامه → تاریخ\n    $(\"#panel_grid .panel-body table th[data-orderby='auto_letter.number']\").text(\"شماره\");           // شماره نامه → شماره\n    $(\"#panel_grid .panel-body table th[data-orderby='auto_letter.subject']\").text(\"موضوع\");          // موضوع نامه → موضوع\n}\n\n// Debounce function to limit observer callbacks\nfunction debounce(fn, wait) {\n    let timeout;\n    return function(...args) {\n        clearTimeout(timeout);\n        timeout = setTimeout(() => fn.apply(this, args), wait);\n    };\n}\n\n// Consolidated initialization and observer setup\n$(document).ready(function() {\n    // Initial setup functions\n    function initializeUI() {\n        hideSpecificColumns();\n        hideNonInternalLetters();\n        renameColumnTitles();\n        hideArrow(); // Assuming defined elsewhere\n        appendAjaxLoading(); // Assuming defined elsewhere\n        dropdown_letter_type(); // Assuming defined elsewhere\n\n        // Style buttons\n        $(\"#form\\\\[button_search\\\\]\").addClass(\"btn-success\");\n        $(\"#form\\\\[button_delete_search\\\\]\").addClass(\"btn-danger\");\n\n        // Trigger initial search\n        search_letter();\n\n        // Bind delete search button\n        $(\"#button_delete_search\").click(function() {\n            delete_search(); // Assuming defined elsewhere\n        });\n\n        // Add advanced search toggle icons\n        $(\"#subtitle_advanced span\").prepend(\n            '<span class=\"glyphicon glyphicon-chevron-down downAdvanced\" onclick=\"HideAdvanced()\"></span>' +\n            '<span class=\"glyphicon glyphicon-chevron-left leftAdvanced\" onclick=\"ShowAdvanced()\"></span>'\n        );\n        HideAdvanced(); // Assuming defined elsewhere\n        $(\".glyphicon\").css(\"cursor\", \"pointer\");\n\n        // Execute hidden JS if present (consider replacing eval)\n        if ($('#hidden_js').getValue() !== '') {\n            try {\n                eval($('#hidden_js').getValue());\n            } catch (e) {\n                console.error(\"Error in eval:\", e);\n            }\n        }\n    }\n\n    // Run initial setup\n    initializeUI();\n\n    // Single MutationObserver with debounced updates\n    const target = document.querySelector(\"#panel_grid .panel-body\");\n    if (target) {\n        const updateTable = debounce(() => {\n            hideSpecificColumns();\n            hideNonInternalLetters();\n            renameColumnTitles();\n        }, 2); // Adjust wait time as needed (100ms)\n\n        const observer = new MutationObserver(updateTable);\n        observer.observe(target, { childList: true, subtree: true });\n    } else {\n        console.warn(\"Target '#panel_grid .panel-body' not found! Adjust the selector if needed.\");\n    }\n});"},"language":"en","externalLibs":"/plugin/templateMaker/functions.js,\n/plugin/automation/functions.js,\n/plugin/automation/fancytree/jquery-ui.min.js,\n/plugin/automation/fancytree/src/skin-win8/ui.fancytree.css,\n/plugin/automation/fancytree/src/jquery.fancytree.js,\n/plugin/automation/fancytree/src/jquery.fancytree.table.js","printable":false,"items":[[{"type":"subtitle","id":"subtitle0000000001","label":"آرشیو ارجاعات\n","ariaLabel":"","colSpan":12}],[{"type":"panel","id":"panel_grid","content":"@@panel_grid\n\n","border":"0px","colSpan":12}],[{"type":"hidden","variable":"hidden_inputDocPath","var_uid":"9019345115a41f4d24e21e1087545427","dataType":"string","protectedValue":false,"id":"hidden_inputDocPath","name":"hidden_inputDocPath","defaultValue":"","dbConnection":"workflow","dbConnectionLabel":"PM Database","sql":"","var_name":"hidden_inputDocPath","colSpan":2},{"type":"hidden","variable":"hidden_printPath","var_uid":"4281412185a4ca6a112ba10068025481","dataType":"string","protectedValue":false,"id":"hidden_printPath","name":"hidden_printPath","defaultValue":"","dbConnection":"workflow","dbConnectionLabel":"PM Database","sql":"","var_name":"hidden_printPath","colSpan":2},{"type":"hidden","variable":"hidden_user_logged","var_uid":"6805627285a4dd9ca5d8d88011178765","dataType":"string","protectedValue":false,"id":"hidden_user_logged","name":"hidden_user_logged","defaultValue":"","dbConnection":"workflow","dbConnectionLabel":"PM Database","sql":"","var_name":"hidden_user_logged","colSpan":2},{"type":"hidden","variable":"hidden_js","var_uid":"4718267325a3794a4dab233090688849","dataType":"string","protectedValue":false,"id":"hidden_js","name":"hidden_js","defaultValue":"","dbConnection":"workflow","dbConnectionLabel":"PM Database","sql":"","var_name":"hidden_js","colSpan":2},{"type":"hidden","variable":"orderColumn","var_uid":"4090886265bd3f83c46f5c6047040657","dataType":"string","protectedValue":false,"id":"orderColumn","name":"orderColumn","defaultValue":"","dbConnection":"workflow","dbConnectionLabel":"PM Database","sql":"","var_name":"orderColumn","colSpan":2},{"type":"hidden","variable":"orderType","var_uid":"9602034105bd3f845477969000579483","dataType":"string","protectedValue":false,"id":"orderType","name":"orderType","defaultValue":"asc","dbConnection":"workflow","dbConnectionLabel":"PM Database","sql":"","var_name":"orderType","colSpan":2}],[{"type":"panel","id":"panel_modal","content":"\n<!-- Modal -->\n<div id=\"detailModal\" name=\"detailModal\" class=\"modal fade\" role=\"dialog\">\n  <div class=\"modal-dialog modal-lg\" style=\"z-index:1050;\">\n\n    <!-- Modal content-->\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n        <h4 class=\"modal-title\">Modal Title</h4>\n      </div>\n      <div class=\"modal-body\" style=\"\">\n        <p>Modal Content</p>\n      </div>\n      <!--div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">بستن</button>\n      </div-->\n    </div>\n\n  </div>\n</div>","border":"0px","colSpan":12}],[{"type":"panel","id":"panel_tree","content":"<div id=\"treeModal\" name=\"treeModal\" class=\"modal fade\" role=\"dialog\">\n  <div class=\"modal-dialog modal-lg\" style=\"z-index:1050;max-width: 90%;max-height: 90%;width: unset;\">\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n        <h4 class=\"modal-title\">ارجاعات</h4>\n      </div>\n      <div class=\"modal-body\" style=\"\">\n\t\t<table id=\"treegrid\" class=\"table table-striped table-bordered table-hover\">\n\t\t\t<thead>\n\t\t\t  <tr>\n\t\t\t\t<th>#</th>\n\t\t\t\t<th>از</th>\n\t\t\t\t<th>تاریخ ارسال</th>\n\t\t\t\t<th>نوع گیرنده</th>\n\t\t\t\t<th>نوع ارجاع</th>\n\t\t\t\t<th>به</th>\n\t\t\t\t<th>مهلت اجرا</th>\n\t\t\t\t<th>تاریخ مشاهده</th>\n\t\t\t\t<th>تاریخ به روز رسانی</th>\n\t\t\t\t<th>تاریخ اتمام</th>\n\t\t\t\t<th>توضیحات</th>\n\t\t\t  </tr>\n\t\t\t</thead>\n\t\t\t<tbody>\n\t\t\t  <tr>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t\t<td></td>\n\t\t\t  </tr>\n\t\t\t</tbody>\n\t\t</table>\n      </div>\n      <!--div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">بستن</button>\n      </div-->\n    </div>\n  </div>\n</div>","border":"0px","colSpan":12}],[{"type":"panel","id":"panel_modal1","content":"\n<!-- Modal -->\n<div id=\"sendModal\" name=\"sendModal\" class=\"modal fade\" role=\"dialog\">\n  <div class=\"modal-dialog modal-lg\" style=\"z-index:1050;max-width: 90%;max-height: 90%;width: unset;\">\n\n    <!-- Modal content-->\n    <div class=\"modal-content\">\n      <div class=\"modal-header\">\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\">&times;</button>\n        <h4 class=\"modal-title\">ارجاع</h4>\n      </div>\n      <div class=\"modal-body\" style=\"\">\n        <p>Modal Content</p>\n      </div>\n      <!--div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\">بستن</button>\n      </div-->\n    </div>\n\n  </div>\n</div>","border":"0px","colSpan":12}],[{"type":"hidden","variable":"dropdown_dabirkhaneh","var_uid":"8215632755a3de44285ec16058703589","dataType":"","protectedValue":false,"id":"dropdown_dabirkhaneh","name":"hidden0000000001","defaultValue":"1","dbConnection":"workflow","dbConnectionLabel":"PM Database","sql":"","var_name":"dropdown_dabirkhaneh","colSpan":12}]],"variables":[{"var_uid":"9019345115a41f4d24e21e1087545427","prj_uid":"7142874775a376ac9a1d112057958403","var_name":"hidden_inputDocPath","var_field_type":"string","var_field_size":10,"var_label":"string","var_dbconnection":"workflow","var_dbconnection_label":"PM Database","var_sql":"","var_null":0,"var_default":"","var_accepted_values":[],"inp_doc_uid":"","var_uid_old":"9019345115a41f4d24e21e1087545427","var_name_old":"hidden_inputDocPath","prj_uid_old":"7142874775a376ac9a1d112057958403"},{"var_uid":"4281412185a4ca6a112ba10068025481","prj_uid":"7142874775a376ac9a1d112057958403","var_name":"hidden_printPath","var_field_type":"string","var_field_size":10,"var_label":"string","var_dbconnection":"workflow","var_dbconnection_label":"PM Database","var_sql":"","var_null":0,"var_default":"","var_accepted_values":[],"inp_doc_uid":"","var_uid_old":"4281412185a4ca6a112ba10068025481","var_name_old":"hidden_printPath","prj_uid_old":"7142874775a376ac9a1d112057958403"},{"var_uid":"6805627285a4dd9ca5d8d88011178765","prj_uid":"7142874775a376ac9a1d112057958403","var_name":"hidden_user_logged","var_field_type":"string","var_field_size":10,"var_label":"string","var_dbconnection":"workflow","var_dbconnection_label":"PM Database","var_sql":"","var_null":0,"var_default":"","var_accepted_values":[],"inp_doc_uid":"","var_uid_old":"6805627285a4dd9ca5d8d88011178765","var_name_old":"hidden_user_logged","prj_uid_old":"7142874775a376ac9a1d112057958403"},{"var_uid":"4718267325a3794a4dab233090688849","prj_uid":"7142874775a376ac9a1d112057958403","var_name":"hidden_js","var_field_type":"string","var_field_size":10,"var_label":"string","var_dbconnection":"workflow","var_dbconnection_label":"PM Database","var_sql":"","var_null":0,"var_default":"","var_accepted_values":[],"inp_doc_uid":"","var_uid_old":"4718267325a3794a4dab233090688849","var_name_old":"hidden_js","prj_uid_old":"7142874775a376ac9a1d112057958403"},{"var_uid":"4090886265bd3f83c46f5c6047040657","prj_uid":"7142874775a376ac9a1d112057958403","var_name":"orderColumn","var_field_type":"string","var_field_size":10,"var_label":"string","var_dbconnection":"workflow","var_dbconnection_label":"PM Database","var_sql":"","var_null":0,"var_default":"","var_accepted_values":[],"inp_doc_uid":"","var_uid_old":"4090886265bd3f83c46f5c6047040657","var_name_old":"orderColumn","prj_uid_old":"7142874775a376ac9a1d112057958403"},{"var_uid":"9602034105bd3f845477969000579483","prj_uid":"7142874775a376ac9a1d112057958403","var_name":"orderType","var_field_type":"string","var_field_size":10,"var_label":"string","var_dbconnection":"workflow","var_dbconnection_label":"PM Database","var_sql":"","var_null":0,"var_default":"","var_accepted_values":[],"inp_doc_uid":"","var_uid_old":"9602034105bd3f845477969000579483","var_name_old":"orderType","prj_uid_old":"7142874775a376ac9a1d112057958403"},{"var_uid":"8215632755a3de44285ec16058703589","prj_uid":"7142874775a376ac9a1d112057958403","var_name":"dropdown_dabirkhaneh","var_field_type":"string","var_field_size":10,"var_label":"string","var_dbconnection":"workflow","var_dbconnection_label":"PM Database","var_sql":"","var_null":0,"var_default":"","var_accepted_values":[],"inp_doc_uid":"","var_uid_old":"8215632755a3de44285ec16058703589","var_name_old":"dropdown_dabirkhaneh","prj_uid_old":"7142874775a376ac9a1d112057958403"}]}]}